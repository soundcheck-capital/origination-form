# Tests End-to-End avec Playwright

Ce dossier contient tous les tests end-to-end pour l'application de formulaire d'origination SoundCheck.

## Structure des tests

```
tests/
â”œâ”€â”€ e2e/
â”‚   â”œâ”€â”€ components/          # Tests de base de l'application
â”‚   â”‚   â””â”€â”€ component-mounting.spec.ts
â”‚   â”œâ”€â”€ steps/               # Tests dÃ©taillÃ©s par Ã©tape
â”‚   â”‚   â”œâ”€â”€ step1-personal-info.spec.ts
â”‚   â”‚   â”œâ”€â”€ step2-company-info.spec.ts
â”‚   â”‚   â”œâ”€â”€ step3-ticketing.spec.ts
â”‚   â”‚   â”œâ”€â”€ step4-your-funds.spec.ts
â”‚   â”‚   â””â”€â”€ step-navigation.spec.ts
â”‚   â”œâ”€â”€ api/                 # Tests des appels API
â”‚   â”‚   â””â”€â”€ api-calls.spec.ts
â”‚   â””â”€â”€ flows/               # Tests de flux complets
â”‚       â””â”€â”€ complete-flow.spec.ts
â”œâ”€â”€ utils/                   # Utilitaires de test
â”‚   â””â”€â”€ testHelpers.ts       # Helper pour automatiser le formulaire
â”œâ”€â”€ fixtures/                # DonnÃ©es de test
â”‚   â””â”€â”€ testData.ts          # Jeux de donnÃ©es pour les tests
â””â”€â”€ README.md               # Cette documentation
```

## Installation et Configuration

### 1. Installer les dÃ©pendances
```bash
npm install -D @playwright/test
npx playwright install
```

### 2. Configuration
La configuration Playwright se trouve dans `playwright.config.ts` Ã  la racine du projet.

### 3. Variables d'environnement
Assurez-vous que votre fichier `.env` contient les bonnes variables :
```env
REACT_APP_WEBHOOK_URL=votre_webhook_url
REACT_APP_WEBHOOK_URL_FILES=votre_webhook_files_url
REACT_APP_HUBSPOT_COMPANY_ID=votre_company_id
# etc.
```

## Commandes disponibles

### Tests complets
```bash
# Lancer tous les tests
npm run test:e2e

# Lancer avec interface graphique
npm run test:e2e:ui

# Lancer en mode headed (voir le navigateur)
npm run test:e2e:headed

# Lancer en mode debug (pas Ã  pas)
npm run test:e2e:debug
```

### Tests par catÃ©gorie
```bash
# Tests de base de l'application
npm run test:components

# Tests dÃ©taillÃ©s par Ã©tape
npm run test:steps
npm run test:step1          # Ã‰tape 1: Informations personnelles
npm run test:step2          # Ã‰tape 2: Informations entreprise
npm run test:step3          # Ã‰tape 3: Ticketing (9 champs)
npm run test:step4          # Ã‰tape 4: Your Funding  
npm run test:step5          # Ã‰tape 5: Ownership (propriÃ©taires multiples)
npm run test:step6          # Ã‰tape 6: Finances (questions conditionnelles)
npm run test:step7          # Ã‰tape 7: Ticketing Information (upload)
npm run test:step8          # Ã‰tape 8: Financial Information (upload)
npm run test:step9          # Ã‰tape 9: Legal Information (upload)
npm run test:step10         # Ã‰tape 10: Additional Information (texte)
npm run test:navigation     # Navigation entre Ã©tapes

# Tests API uniquement
npm run test:api

# Tests de flux complets uniquement
npm run test:flows
```

### Rapports
```bash
# Voir le rapport HTML des derniers tests
npm run test:report
```

## Types de tests

### 1. Tests de base (`component-mounting.spec.ts`)
- âœ… VÃ©rification que l'application se charge correctement
- âœ… Structure de base prÃ©sente (header, navigation, etc.)
- âœ… Absence d'erreurs JavaScript critiques
- âœ… MÃ©canisme de protection par mot de passe

### 2. Tests par Ã©tape (`/steps/`)

#### **Ã‰tape 1 - Informations personnelles** (`step1-personal-info.spec.ts`)
- âœ… PrÃ©sence de tous les champs (prÃ©nom, nom, email, tÃ©lÃ©phone, rÃ´le)
- âœ… Validation des champs obligatoires
- âœ… Validation de confirmation d'email
- âœ… Options du dropdown "rÃ´le"
- âœ… Format et validation du tÃ©lÃ©phone
- âœ… Navigation vers l'Ã©tape 2
- âœ… Persistance des donnÃ©es
- âœ… AccessibilitÃ© (labels, navigation clavier)

#### **Ã‰tape 2 - Informations entreprise** (`step2-company-info.spec.ts`)
- âœ… Tous les champs entreprise (nom, DBA, EIN, adresse, etc.)
- âœ… Dropdowns (type client, type business, Ã©tats)
- âœ… Validation du format EIN
- âœ… Validation du code postal
- âœ… Champ employÃ©s (numÃ©rique seulement)
- âœ… AutocomplÃ©tion d'adresse (Google Maps)
- âœ… Persistance lors navigation
- âœ… Options dropdown conditionnelles

#### **Ã‰tape 3 - Ticketing** (`step3-ticketing.spec.ts`)
- âœ… Dropdowns partenaires ticketing
- âœ… Champ "Other Partner" conditionnel
- âœ… Options de politique de rÃ¨glement
- âœ… Options de traitement de paiement
- âœ… Champ "Other Payment Processing" conditionnel
- âœ… **6 champs de volume** (Last/Next 12 months)
  - âœ… Number of Events (lastYearEvents, nextYearEvents)
  - âœ… Number of Tickets (lastYearTickets, nextYearTickets)
  - âœ… Sales Amount (lastYearSales, nextYearSales)
- âœ… Validation des champs obligatoires (9 champs total)
- âœ… Validation conditionnelle (champs "Other")
- âœ… Validation valeurs numÃ©riques rÃ©alistes
- âœ… Titres de sections volume
- âœ… Persistance donnÃ©es ticketing + volume

#### **Ã‰tape 4 - Your Funding** (`step4-your-funds.spec.ts`)
- âœ… Champ de montant de financement (CurrencyField)
- âœ… Dropdown timing de financement
- âœ… Dropdown utilisation des fonds
- âœ… Validation format monÃ©taire
- âœ… Validation montants min/max
- âœ… Affichage conditionnel montant de qualification
- âœ… Calculs business logic
- âœ… Gestion cas limites (caractÃ¨res non numÃ©riques)
- âœ… Textes d'aide et disclaimers

#### **Ã‰tape 5 - Ownership** (`step5-ownership.spec.ts`)
- âœ… **PropriÃ©taires multiples** (ajout/suppression dynamique)
- âœ… Champs par propriÃ©taire : nom, pourcentage, adresse, date de naissance
- âœ… **Validation pourcentages** (total = 100%, valeurs cohÃ©rentes)
- âœ… **DatePicker** pour dates de naissance (validation Ã¢ge)
- âœ… **AddressAutocomplete** avec Google Maps
- âœ… Gestion cas limites (caractÃ¨res spÃ©ciaux, adresses longues)
- âœ… Validation business logic (propriÃ©taires rÃ©alistes)
- âœ… Persistance donnÃ©es multiples propriÃ©taires

#### **Ã‰tape 6 - Finances** (`step6-finances.spec.ts`)  
- âœ… **Questions conditionnelles progressives** (10 questions oui/non)
- âœ… **SystÃ¨me de dettes dynamique** (types + montants)
- âœ… **Champs conditionnels** (date fin bail, dÃ©tails dettes)
- âœ… **Logique de saut** et dÃ©pendances entre questions
- âœ… Validation business pour montants de dettes
- âœ… **Champs additionnels** (rÃ©fÃ©rences industrie, commentaires)
- âœ… **ScÃ©narios mixtes** (rÃ©ponses cohÃ©rentes business)
- âœ… Persistance rÃ©ponses complexes

#### **Ã‰tape 7 - Ticketing Information** (`step7-ticketing-information.spec.ts`)
- âœ… **2 champs d'upload de fichiers**
  - âœ… Reports ticketing company (obligatoire, multiples fichiers)
  - âœ… Service Agreement (conditionnel, fichier unique)
- âœ… **Validation types de fichiers** (.pdf, .xlsx, .csv, .jpg, .png)
- âœ… **Descriptions dÃ©taillÃ©es** et textes d'aide
- âœ… **Logique conditionnelle** (Service Agreement si paymentProcessing = 'Venue')
- âœ… Simulation upload et feedback visuel
- âœ… Gestion fichiers volumineux et erreurs
- âœ… **AccessibilitÃ©** navigation clavier

#### **Ã‰tape 8 - Financial Information** (`step8-financial-information.spec.ts`)
- âœ… **2 champs d'upload de fichiers**
  - âœ… Financial Statements (obligatoire, multiples fichiers)
  - âœ… Bank Statements (optionnel, multiples fichiers)
- âœ… **Validation documents financiers** (P&L, B/S, relevÃ©s bancaires)
- âœ… **Upload multiples** (plusieurs annÃ©es, plusieurs mois)
- âœ… Simulation scÃ©narios complets (tous documents)
- âœ… **Drag & Drop** interaction
- âœ… Gestion fichiers corrompus/vides
- âœ… Persistance uploads complexes

#### **Ã‰tape 9 - Legal Information** (`step9-legal-information.spec.ts`)
- âœ… **5 champs d'upload de fichiers**
  - âœ… Certificate of Incorporation (obligatoire)
  - âœ… Legal Entity Chart (optionnel) 
  - âœ… Government ID (optionnel)
  - âœ… W-9 Form (optionnel)
  - âœ… Other Documents (optionnel, multiples fichiers)
- âœ… **Descriptions dÃ©taillÃ©es** pour chaque type de document
- âœ… **Upload minimal vs complet** (obligatoire seul vs tous documents)
- âœ… **Validation types spÃ©cialisÃ©s** (ID photos, formulaires fiscaux)
- âœ… **CatÃ©gorie "Other"** avec multiples sous-types
- âœ… Gestion portfolios documentaires complexes

#### **Ã‰tape 10 - Additional Information** (`step10-additional-information.spec.ts`)
- âœ… **2 champs TextArea obligatoires**
  - âœ… Industry References (rÃ©fÃ©rences industrie)
  - âœ… Additional Comments (commentaires additionnels)
- âœ… **Validation texte** (champs obligatoires, longueurs)
- âœ… **CaractÃ¨res spÃ©ciaux** (emails, URLs, accents, symboles)
- âœ… **Formatage prÃ©servÃ©** (sauts de ligne, espaces multiples)
- âœ… **ScÃ©narios business rÃ©alistes** (petite/moyenne/grande entreprise)
- âœ… **Copy-paste** et Ã©dition de texte long
- âœ… **AccessibilitÃ©** TextArea (focus, labels, navigation clavier)
- âœ… **Interaction utilisateur** (resize, sÃ©lection, modification)

## ðŸŽ¯ **RÃ©capitulatif complet de la couverture**

### **Ã‰tapes testÃ©es (10/10)**
1. **Personal Info** - 7 champs + validation emails/tÃ©lÃ©phone
2. **Company Info** - 12 champs + autocomplÃ©tion Google Maps
3. **Ticketing** - 9 champs (3 ticketing + 6 volume) + logique conditionnelle
4. **Your Funding** - 3 champs + calculs mÃ©tier + validations montants
5. **Ownership** - PropriÃ©taires multiples + validation pourcentages + dates
6. **Finances** - 10 questions conditionnelles + systÃ¨me dettes dynamique
7. **Ticketing Information** - 2 uploads (obligatoire + conditionnel)
8. **Financial Information** - 2 uploads (P&L, relevÃ©s bancaires)
9. **Legal Information** - 5 uploads (certificat + documents optionnels)
10. **Additional Information** - 2 champs TextArea + validation texte

### **Statistiques de test**
- âœ… **75+ tests** rÃ©partis sur 10 fichiers spÃ©cialisÃ©s
- âœ… **3 jeux de donnÃ©es** complets (petit/moyen/grand)
- âœ… **42+ champs** de formulaire avec validations
- âœ… **9 uploads** de fichiers avec simulation complÃ¨te
- âœ… **110+ scÃ©narios** de validation mÃ©tier

#### **Navigation globale** (`step-navigation.spec.ts`)
- âœ… Barre de progression sur toutes les Ã©tapes
- âœ… Titres corrects pour chaque Ã©tape
- âœ… Persistance des donnÃ©es sur navigation arriÃ¨re
- âœ… Validation bloque navigation si incomplet
- âœ… Indicateurs de numÃ©ro d'Ã©tape

**Exemple :**
```typescript
test('Personal Info Step components mount correctly', async ({ page }) => {
  // VÃ©rifie que tous les champs sont prÃ©sents et visibles
});
```

### 2. Tests des appels API (`api-calls.spec.ts`)
- âœ… Test de soumission des donnÃ©es du formulaire
- âœ… Test d'upload de fichiers
- âœ… Gestion des erreurs API
- âœ… VÃ©rification des paramÃ¨tres envoyÃ©s
- âœ… Test avec 3 jeux de donnÃ©es diffÃ©rents

**Jeux de donnÃ©es testÃ©s :**
1. **Petite entreprise** : 5 employÃ©s, $50k de financement
2. **Moyenne entreprise** : 25 employÃ©s, $250k de financement  
3. **Grande entreprise** : 150 employÃ©s, $1M de financement

### 3. Tests de flux complets (`complete-flow.spec.ts`)
- âœ… Parcours complet du formulaire
- âœ… Navigation bidirectionnelle avec conservation des donnÃ©es
- âœ… FonctionnalitÃ© du Summary (clic pour retourner aux Ã©tapes)
- âœ… Tests responsive (mobile/desktop)
- âœ… Upload de fichiers intÃ©grÃ© au flux

## DonnÃ©es de test

Les jeux de donnÃ©es sont dÃ©finis dans `fixtures/testData.ts` :

```typescript
// Exemple d'utilisation
import { smallCompanyData, mediumCompanyData, largeCompanyData } from '../fixtures/testData';

test('Test avec petite entreprise', async ({ page }) => {
  await formHelper.fillPersonalInfo(smallCompanyData.personalInfo);
  // ...
});
```

## Utilitaires disponibles

La classe `FormHelper` dans `utils/testHelpers.ts` fournit des mÃ©thodes utiles :

```typescript
const formHelper = new FormHelper(page);

// Navigation
await formHelper.navigateToApp();
await formHelper.goToNextStep();
await formHelper.goToPreviousStep();

// Remplissage de formulaire
await formHelper.fillPersonalInfo(data.personalInfo);
await formHelper.fillCompanyInfo(data.companyInfo);

// Upload de fichiers
await formHelper.uploadTestFile('ticketingCompanyReport', 'test.pdf');

// Mock des API
await formHelper.mockApiCalls();

// Attentes
await formHelper.expectStep('Get Funding');
await formHelper.waitForProgress(50);
```

## Debugging des tests

### Mode debug
```bash
npm run test:e2e:debug
```
Permet d'exÃ©cuter les tests pas Ã  pas avec inspection du navigateur.

### Screenshots et vidÃ©os
En cas d'Ã©chec, Playwright capture automatiquement :
- Screenshots des Ã©checs
- VidÃ©os des tests Ã©chouÃ©s
- Traces complÃ¨tes de l'exÃ©cution

### Logs
Les tests incluent des logs dÃ©taillÃ©s pour debugger les problÃ¨mes :
```typescript
console.log('=== Environment Variables Debug ===');
console.log('REACT_APP_WEBHOOK_URL:', process.env.REACT_APP_WEBHOOK_URL);
```

## Bonnes pratiques

### 1. Isolation des tests
Chaque test est isolÃ© avec son propre contexte de navigateur.

### 2. Mock des API
Les tests utilisent des mocks pour Ã©viter les vraies requÃªtes en production :
```typescript
await page.route('**/hook.us1.make.com/**', route => {
  route.fulfill({ status: 200, body: JSON.stringify({ success: true }) });
});
```

### 3. Attentes robustes
Utilisation d'attentes avec auto-retry :
```typescript
await expect(page.locator('button')).toBeVisible();
await expect(page.locator('input')).toHaveValue('expected');
```

### 4. DonnÃ©es de test rÃ©alistes
Les jeux de donnÃ©es reflÃ¨tent des cas d'usage rÃ©els avec des variations significatives.

## CI/CD

Les tests peuvent Ãªtre intÃ©grÃ©s dans votre pipeline CI/CD :
```yaml
# Exemple GitHub Actions
- name: Run Playwright tests
  run: npm run test:e2e
  
- name: Upload test results
  uses: actions/upload-artifact@v3
  with:
    name: playwright-report
    path: playwright-report/
```

## Maintenance

### Mise Ã  jour des tests
Lorsque vous modifiez l'interface :
1. Mettez Ã  jour les sÃ©lecteurs dans `testHelpers.ts`
2. Ajustez les donnÃ©es de test si nÃ©cessaire
3. ExÃ©cutez les tests pour vÃ©rifier la compatibilitÃ©

### Ajout de nouveaux tests
1. CrÃ©ez un nouveau fichier `.spec.ts` dans le dossier appropriÃ©
2. Importez les utilitaires et fixtures nÃ©cessaires
3. Suivez les patterns existants pour la cohÃ©rence
